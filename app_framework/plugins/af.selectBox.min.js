/*
: 2011 Intel
 @description:  This script will replace all drop downs with friendly select controls.  Users can still interact
 with the old drop down box as normal with javascript, and this will be reflected
*/
(function(c){function h(a,b,d){!0===d&&(this.getAttribute("multiple")||c.selectBox.updateMaskValue(this.parentNode.id,this.text,this.value),this.parentNode.value=this.value);return d}function k(a,b,d){this.options[d]&&(this.getAttribute("multiple")||c.selectBox.updateMaskValue(this.linker,this.options[d].value,this.options[d].text),this.value=this.options[d].value);return d}function l(a){var b=a.target;c(b.linker).remove();delete b.linker;a.stopPropagation()}c.selectBox={scroller:null,currLinker:null,
getOldSelects:function(a){if(c.os.android&&!c.os.androidICS)if(c.fn.scroller){var b=a&&document.getElementById(a)?document.getElementById(a):document;if(b){a=b.getElementsByTagName("select");for(b=0;b<a.length;b++){var d=a[b];d.style.display="none";var f=c.create("div",{className:"afFakeSelect"});f.get(0).linker=a[b];d.linker=f.get(0);f.insertAfter(a[b]);d.watch("selectedIndex",k);for(var e=0;e<d.options.length;e++)d.options[e].watch("selected",h),d.options[e].selected&&f.html(d.options[e].text);
c(d).one("destroy",l)}this.createHtml()}else alert("Could not find container element for af.selectBox "+a)}else alert("This library requires af.scroller")},updateDropdown:function(a){if(a)for(var b=0;b<a.options.length;b++)a.options[b].selected&&(a.linker.innerHTML=a.options[b].text)},initDropDown:function(a){if(!a.disabled&&a&&a.options&&0!==a.options.length){var b=0,d=c("#afSelectBoxfix");d.html("<ul></ul>");for(var d=d.find("ul"),f=0;f<a.options.length;f++){a.options[f].watch("selected",h);var e=
a.options[f].selected?"selected":"";e&&(b=f+1);e=c.create("li",{html:a.options[f].text,className:e});e.data("ind",f);d.append(e)}c("#afSelectBoxContainer").show();try{if(0<b&&"multiple"!=a.getAttribute("multiple")){a=0;var g=numOnly(d.find("li").computedStyle("height")),m=numOnly(c("#afSelectBoxContainer").computedStyle("height"));b*g>=m&&(a=(b-1)*-g);this.scroller.scrollTo({x:0,y:a})}}catch(n){console.log("error init dropdown"+n)}b="block"==c("#afSelectClose").css("display")?numOnly(c("#afSelectClose").height()):
0;c("#afSelectWrapper").height(numOnly(c("#afSelectBoxContainer").height())-b+"px")}},updateMaskValue:function(a,b,d){c(a).html(d)},setDropDownValue:function(a,b){if(a){var d=c(a);b=parseInt(b,10);a.getAttribute("multiple")?(d=c("#afSelectBoxfix li:nth-child("+(b+1)+")"),d.hasClass("selected")?d.removeClass("selected"):d.addClass("selected")):(a.selectedIndex=b,d.find("option").prop("selected",!1),d.find("option:nth-child("+(b+1)+")").prop("selected",!0),this.scroller.scrollTo({x:0,y:0}),this.hideDropDown());
c(a).trigger("change")}},hideDropDown:function(){c("#afSelectBoxContainer").hide();c("#afSelectBoxfix").html("")},createHtml:function(){var a=this;document.getElementById("afSelectBoxfix")||c(document).ready(function(){c(document).on("click",".afFakeSelect",function(b){this.linker.disabled||(a.currLinker=this,"multiple"==this.linker.getAttribute("multiple")?c("#afSelectClose").show():c("#afSelectClose").hide(),a.initDropDown(this.linker))});var b=c.create("div",{id:"afSelectBoxContainer"}),d=c.create("div",
{id:"afSelectBoxfix"}),f=c.create("div",{id:"afSelectWrapper"});f.css("position","relative");f.append(d);var d=c.create("div",{id:"afSelectClose",html:"<a id='afSelectDone'>Done</a> <a id='afSelectCancel'>Cancel</a>"}),e=c("#afui");b.prepend(d).append(f);0<e.length?e.append(b):document.body.appendChild(b.get(0));a.scroller=c.query("#afSelectBoxfix").scroller({scroller:!1,verticalScroll:!0,vScrollCSS:"jqselectscrollBarV"});c("#afSelectBoxfix").on("click","li",function(b){b=c(b.target);a.setDropDownValue(a.currLinker.linker,
b.data("ind"))});c("#afSelectBoxContainer").on("click","a",function(b){if("afSelectCancel"==b.target.id)return a.hideDropDown();var d=c(a.currLinker.linker);d.find("option").prop("selected",!1);c("#afSelectBoxfix li").each(function(b){b=c(this);if(b.hasClass("selected")){var f=parseInt(b.data("ind"),10);d.find("option:nth-child("+(f+1)+")").prop("selected",!0);a.currLinker.innerHTML=b.html()}});a.hideDropDown()})})}};HTMLElement.prototype.watch||(HTMLElement.prototype.watch=function(a,b){var d=this[a],
c=d,e=function(){return c},g=function(e){d=c;return c=b.call(this,a,d,e)};delete this[a]&&(HTMLElement.defineProperty?HTMLElement.defineProperty(this,a,{get:e,set:g,enumerable:!1,configurable:!0}):HTMLElement.prototype.__defineGetter__&&HTMLElement.prototype.__defineSetter__&&(HTMLElement.prototype.__defineGetter__.call(this,a,e),HTMLElement.prototype.__defineSetter__.call(this,a,g)))});HTMLElement.prototype.unwatch||(HTMLElement.prototype.unwatch=function(a){var b=this[a];delete this[a];this[a]=
b})})(af);
