/*
 Indiepath 2011 - Tim Fisher
 Modifications/enhancements by appMobi for App Framework

*/
(function(b){b.fn.popup=function(b){return new h(this[0],b)};var f=[],h=function(){var e=function(a,c){if(this.container="string"===typeof a||a instanceof String?document.getElementById(a):a)try{if("string"===typeof c||"number"===typeof c)c={message:c,cancelOnly:"true",cancelText:"OK"};this.id=id=c.id=c.id||b.uuid();this.title=c.suppressTitle?"":c.title||"Alert";this.message=c.message||"";this.cancelText=c.cancelText||"Cancel";this.cancelCallback=c.cancelCallback||function(){};this.cancelClass=c.cancelClass||
"button";this.doneText=c.doneText||"Done";this.doneCallback=c.doneCallback||function(a){};this.doneClass=c.doneClass||"button";this.cancelOnly=c.cancelOnly||!1;this.onShow=c.onShow||function(){};this.autoCloseDone=void 0!==c.autoCloseDone?c.autoCloseDone:!0;f.push(this);1==f.length&&this.show()}catch(d){console.log("error adding popup "+d)}else alert("Error finding container for popup "+a)};e.prototype={id:null,title:null,message:null,cancelText:null,cancelCallback:null,cancelClass:null,doneText:null,
doneCallback:null,doneClass:null,cancelOnly:!1,onShow:null,autoCloseDone:!0,supressTitle:!1,show:function(){var a=this,c='<div id="'+this.id+'" class="afPopup hidden"><header>'+this.title+"</header><div>"+this.message+'</div><footer style="clear:both;"><a href="javascript:;" class="'+this.cancelClass+'" id="cancel">'+this.cancelText+'</a><a href="javascript:;" class="'+this.doneClass+'" id="action">'+this.doneText+"</a> </footer></div></div>";b(this.container).append(b(c));var d=b.query("#"+this.id);
d.bind("close",function(){a.hide()});this.cancelOnly&&(d.find("A#action").hide(),d.find("A#cancel").addClass("center"));d.find("A").each(function(){var c=b(this);c.bind("click",function(b){"cancel"==c.attr("id")?(a.cancelCallback.call(a.cancelCallback,a),a.hide()):(a.doneCallback.call(a.doneCallback,a),a.autoCloseDone&&a.hide());b.preventDefault()})});a.positionPopup();b.blockUI(0.5);d.bind("orientationchange",function(){a.positionPopup()});d.find("header").show();d.find("footer").show();setTimeout(function(){d.removeClass("hidden");
a.onShow(a)},50)},hide:function(){var a=this;b.query("#"+a.id).addClass("hidden");b.unblockUI();b.os.ie||b.os.android?a.remove():setTimeout(function(){a.remove()},250)},remove:function(){var a=b.query("#"+this.id);a.unbind("close");a.find("BUTTON#action").unbind("click");a.find("BUTTON#cancel").unbind("click");a.unbind("orientationchange").remove();f.splice(0,1);0<f.length&&f[0].show()},positionPopup:function(){var a=b.query("#"+this.id);a.css("top",window.innerHeight/2.5+window.pageYOffset-a[0].clientHeight/
2+"px");a.css("left",window.innerWidth/2-a[0].clientWidth/2+"px")}};return e}(),g=!1;b.blockUI=function(e){g||(e=e?" style='opacity:"+e+";'":"",b.query("BODY").prepend(b("<div id='mask'"+e+"></div>")),b.query("BODY DIV#mask").bind("touchstart",function(a){a.preventDefault()}),b.query("BODY DIV#mask").bind("touchmove",function(a){a.preventDefault()}),g=!0)};b.unblockUI=function(){g=!1;b.query("BODY DIV#mask").unbind("touchstart");b.query("BODY DIV#mask").unbind("touchmove");b("BODY DIV#mask").remove()}})(af);
