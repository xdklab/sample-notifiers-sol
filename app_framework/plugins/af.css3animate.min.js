(function(e){var g=[],m=function(b,a){var c,d;c="string"==typeof b||b instanceof String?document.getElementById(b):e.is$(b)?b[0]:b;c.afCSS3AnimateId||(c.afCSS3AnimateId=e.uuid());d=c.afCSS3AnimateId;g[d]?(g[d].animate(a),c=g[d]):(c=l(c,a),g[d]=c);return c};e.fn.css3Animate=function(b){!b.complete&&b.callback&&(b.complete=b.callback);var a=m(this[0],b);b.complete=null;b.sucess=null;b.failure=null;for(var c=1;c<this.length;c++)a.link(this[c],b);return a};e.css3AnimateQueue=function(){return new l.queue};
var n=e.feat.cssTransformStart,p=e.feat.cssTransformEnd,f=e.feat.cssPrefix.replace(/-/g,"")+"TransitionEnd",f=e.os.fennec||""===e.feat.cssPrefix||e.os.ie?"transitionend":f,f=f.replace(f.charAt(0),f.charAt(0).toLowerCase()),l=function(){var b=function(a,c){if(!(this instanceof b))return new b(a,c);this.callbacksStack=[];this.activeEvent=null;this.countStack=0;this.isActive=!1;this.el=a;this.linkFinishedProxy_=e.proxy(this.linkFinished,this);if(this.el){this.animate(c);var d=this;af(this.el).bind("destroy",
function(){var a=d.el.afCSS3AnimateId;d.callbacksStack=[];g[a]&&delete g[a]})}};b.prototype={animate:function(a){this.isActive&&this.cancel();this.isActive=!0;if(a){var c=!!a.addClass,d,b,h=numOnly(a.time);if(c)a.removeClass?af(this.el).replaceClass(a.removeClass,a.addClass):af(this.el).addClass(a.addClass);else{0===h&&(a.time=0);a.y||(a.y=0);a.x||(a.x=0);a.previous&&(d=new e.getCssMatrix(this.el),a.y+=numOnly(d.f),a.x+=numOnly(d.e));a.origin||(a.origin="0% 0%");a.scale||(a.scale="1");a.rotateY||
(a.rotateY="0");a.rotateX||(a.rotateX="0");a.skewY||(a.skewY="0");a.skewX||(a.skewX="0");a.timingFunction||(a.timingFunction="linear");if("number"==typeof a.x||-1==a.x.indexOf("%")&&-1==a.x.toLowerCase().indexOf("px")&&-1==a.x.toLowerCase().indexOf("deg"))a.x=parseInt(a.x,10)+"px";if("number"==typeof a.y||-1==a.y.indexOf("%")&&-1==a.y.toLowerCase().indexOf("px")&&-1==a.y.toLowerCase().indexOf("deg"))a.y=parseInt(a.y,10)+"px";d="translate"+n+a.x+","+a.y+p+" scale("+parseFloat(a.scale)+") rotate("+
a.rotateX+")";e.os.opera||(d+=" rotateY("+a.rotateY+")");d+=" skew("+a.skewX+","+a.skewY+")";this.el.style[e.feat.cssPrefix+"Transform"]=d;this.el.style[e.feat.cssPrefix+"BackfaceVisibility"]="hidden";void 0!==a.opacity&&(this.el.style.opacity=a.opacity);a.width&&(this.el.style.width=a.width);a.height&&(this.el.style.height=a.height);this.el.style[e.feat.cssPrefix+"TransitionProperty"]="all";-1===(""+a.time).indexOf("s")?(d="ms",b=a.time+d):-1!==a.time.indexOf("ms")?(d="ms",b=a.time):(d="s",b=a.time+
d);a.delay&&(this.el.style[e.feat.cssPrefix+"TransitionDelay"]=a.delay);this.el.style[e.feat.cssPrefix+"TransitionDuration"]=b;this.el.style[e.feat.cssPrefix+"TransitionTimingFunction"]=a.timingFunction;this.el.style[e.feat.cssPrefix+"TransformOrigin"]=a.origin}this.callbacksStack.push({complete:a.complete,success:a.success,failure:a.failure});this.countStack++;var k=this;b=window.getComputedStyle(this.el);c&&(c=b[e.feat.cssPrefix+"TransitionDuration"],h=numOnly(c),a.time=h,-1!==c.indexOf("ms")?d=
"ms":(d="s",a.time*=1E3));0===h||"ms"==d&&5>h||"none"==b.display?e.asap(e.proxy(this.finishAnimation,this,[!1])):(this.activeEvent=function(a){clearTimeout(k.timeout);k.finishAnimation(a);k.el.removeEventListener(f,k.activeEvent,!1)},k.timeout=setTimeout(this.activeEvent,numOnly(a.time)+50),this.el.addEventListener(f,this.activeEvent,!1))}else alert("Please provide configuration options for animation of "+this.el.id)},addCallbackHook:function(a){a&&this.callbacksStack.push(a);this.countStack++;return this.linkFinishedProxy_},
linkFinished:function(a){a?this.cancel():this.finishAnimation()},finishAnimation:function(a){a&&a.preventDefault&&a.preventDefault();this.isActive&&(this.countStack--,0===this.countStack&&this.fireCallbacks(!1))},fireCallbacks:function(a){this.clearEvents();var c=this.callbacksStack;this.cleanup();for(var d=0;d<c.length;d++){var b=c[d].complete,e=c[d].success,f=c[d].failure;b&&"function"==typeof b&&b(a);a&&f&&"function"==typeof f?f():e&&"function"==typeof e&&e()}},cancel:function(){this.isActive&&
this.fireCallbacks(!0)},cleanup:function(){this.callbacksStack=[];this.isActive=!1;this.countStack=0},clearEvents:function(){this.activeEvent&&this.el.removeEventListener(f,this.activeEvent,!1);this.activeEvent=null},link:function(a,c){var b={complete:c.complete,success:c.success,failure:c.failure};c.complete=this.addCallbackHook(b);c.success=null;c.failure=null;m(a,c);c.complete=b.complete;c.success=b.success;c.failure=b.failure;return this}};return b}();l.queue=function(){return{elements:[],push:function(b){this.elements.push(b)},
pop:function(){return this.elements.pop()},run:function(){var b=this;if(0!==this.elements.length&&("function"==typeof this.elements[0]&&this.shift()(),0!==this.elements.length)){var a=this.shift();0<this.elements.length&&(a.complete=function(a){a||b.run()});l(document.getElementById(a.id),a)}},shift:function(){return this.elements.shift()}}}})(af);
